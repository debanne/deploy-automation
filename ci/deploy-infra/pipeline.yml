resources:
  - name: automation
    type: git
    icon: github
    source:
      uri: https://github.com/debanne/deploy-automation.git
      branch: ((source_branch))
  - name: config
    type: git
    icon: github
    source:
      uri: https://github.com/debanne/deploy-config.git
      branch: master
  - name: image
    type: registry-image
    icon: docker
    source:
      repository: busybox

jobs:
  - name: deploy
    plan:
      - in_parallel:
        - get: automation
        - get: image
        - get: config
      - task: deploy
        image: image
        config:
          platform: linux
          inputs:
          - name: config
          params:
            COLOR: ((color))
            ENV_NAME: ((env_name))
            VERSION: ((component-version))
          run:
            path: sh
            args:
              - "-c"
              - |
                echo "Deploying '$COLOR' on $ENV_NAME v$VERSION..."
                sleep 10
                echo "OK!"